layui.define(["layer", "ztree"], function (a) { function f(a, b, c) { var d, e, f, g, h; c = c || !0; for (d in a) if (e = a[d], b instanceof Object) { f = !0; for (g in b) { if (h = b[g], e[g] == h && !c) return d; if (c && e[g] != h) { f = !1; break } } if (f) return d } else if (e == b) return d; return -1 } var b = "treeselect", d = (layui.layer, layui.jquery), e = function () { this.v = "1.0.0" }; e.prototype.render = function (a) { function l(b) { var c, e, g; for (c = 0, e = b.length; e > c; c++) g = b[c], -1 !== f(k.split(","), g.id) && (i.checkNode(g, !0, !1), d(a.elem).append(['<a href="javascript:;">', g.name, ' <i class="layui-icon" data-action="close" data-tid="' + g.tId + '" data-id="' + g.id + '">&#x1006;</i>', "</a>"].join("")), n()), null !== g.children && void 0 !== g.children && g.children.length > 0 && l(g.children) } function m(b, c) { var j, k, l, m, f = d.fn.zTree.getZTreeObj(c), g = f.getCheckedNodes(!0), h = [], i = []; for (j = 0, k = g.length; k > j; j++) h.push(g[j].id), i.push({ name: g[j].name, id: g[j].id, tid: g[j].tId }); _div = d(a.elem), l = [], layui.each(i, function (a, b) { l.push(['<a href="javascript:;">', b.name, ' <i class="layui-icon" data-action="close" data-tid="' + b.tid + '" data-id="' + b.id + '">&#x1006;</i>', "</a>"].join("")) }), _div.html(l.join("")), m = _div.siblings("input.layui-input"), m.attr("value", h.join(",")), n() } function n() { var b = d(a.elem), c = b.siblings("input.layui-input"); b.find("i[data-action=close]").off("click").on("click", function (a) { var b, e, f, g; layui.stope(a), b = d(this).data("id"), e = d(this).data("tid"), f = i.getNodeByTId(e), i.checkNode(f, !1, !1), g = c.val().split(","), g.remove(b), c.attr("value", g.join(",")), d(this).parent().remove() }) } var i, j, k, b = this, c = { check: { enable: !0, chkboxType: { Y: "", N: "" } }, view: { dblClickExpand: !1 }, data: { simpleData: { enable: !0 } }, callback: { beforeClick: function (a, b) { var c = d.fn.zTree.getZTreeObj(a); c.checkNode(b, !b.checked, null, !0) }, onClick: m, onCheck: m } }, e = (new Date).getTime(), g = "content" + e, h = "treeDemo" + e; return d(a.elem).parent().append('<div class="ztree-input" id="' + a.elem.substr(1) + '"></div>').append(['<div id="' + g + '" class="ztree-content layui-anim layui-anim-upbit">', '<ul id="treeDemo' + e + '" class="ztree"></ul>', "</div>"].join("")).children("input.layui-input").removeAttr("id"), i = d.fn.zTree.init(d("#" + h), c, a.data), j = i.getNodes(), k = d(a.elem).parent().children("input.layui-input").val(), d.trim(k).length > 0 && l(j), d(a.elem).off("click").on("click", function () { d("#" + g).show(), d(document).off("mousedown").on("mousedown", function (b) { "#" + b.target.id == a.elem || b.target.id == g || d(b.target).parents("#" + g).length > 0 || d("#" + g).fadeOut("fast") }) }), b }, Array.prototype.indexOf = function (a) { for (var b = 0; b < this.length; b++) if (this[b] == a) return b; return -1 }, Array.prototype.remove = function (a) { var b = this.indexOf(a); b > -1 && this.splice(b, 1) }, a(b, new e) });